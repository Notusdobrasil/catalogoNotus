<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- Seus estilos gerais -->
  <link rel="stylesheet" href="./styles/style.css" />
  <link rel="stylesheet" href="./styles/styleCarrinho.css" />
  <link rel="stylesheet" href="./styles/configuracoes.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
  />
  <link
    rel="icon"
    href="./image/icone-logosite-quadrado-mask1.svg"
    type="image/x-icon"
  />
  <script src="javascript/traducao.js" defer></script>
  <title>Configura√ß√µes</title>
</head>
<body>

  <header class="header-container">

        <nav id="nav-topo" class="nav-contacts">
            <div class="header-redessociais">
                <a href="https://www.instagram.com/notusdobrasil" target="_blank">
                    <i class="fa-brands fa-instagram"></i>
                </a>
                <a href="https://www.facebook.com/profile.php?id=61559166240715" target="_blank">
                    <i class="fa-brands fa-facebook"></i>
                </a>
                <a href="https://www.youtube.com/@NotusdoBrasil" target="_blank">
                    <i class="fa-brands fa-youtube"></i>
                </a>
                <a href="https://www.linkedin.com/company/notus-do-brasil" target="_blank">
                    <i class="fa-brands fa-linkedin"></i>
                </a>
            </div>
            
            <div id="google_translate_element"></div>

            

            <div class="header-bandeiras">    
                <div class="flags">
                    <img src="image/br.png" alt="Portugu√™s" id="pt">
                    <img src="image/es.png" id="es" alt="es">
                    <img src="image/us.png" alt="English" id="en">
                </div>
            </div>

        </nav>
        <nav id="nav-fixo" class="nav-navegacao">

            <div>
                <a href="index.html" style="cursor:pointer;">
                    <img class="apresentacao__image" src="./image/logo.png"></a>
            </div>

            <div class="header-busca">
                <form id="searchFormIndex" class="search-wrapper">
                <input
                    type="text"
                    id="searchInputIndex"
                    name="search"
                    placeholder="Buscar"
                    required
                />
                <button type="submit" class="search-button">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </button>
                </form>
                <i class="icon-filter fa-solid fa-filter" onclick="toggleFiltroAvancado()" ><p >Filtros</p></i>
            </div>

            <span class="hamburguer" id="hamburguer-menu">
                <i class="fa-solid fa-bars"></i>
            </span>
            <div class="menu_lateral" id="menu-lateral">
                    <a class="link_menu" href="todosprodutos.html">Todos Produtos</a>
                    <div class="dropdown">
                        <a class="link_menu_lateral">Categorias&nbsp;<i class="fa-solid fa-caret-down"></i></a>
                            <ul class="submenu">
                                <li class="has-submenu">
                                    <a href="categoria.html?cat=radiador">Radiador</a>
                                    <ul class="submenu-2">
                                        <!-- Itens ser√£o preenchidos dinamicamente -->
                                    </ul>
                                </li>
                                <li class="has-submenu">
                                    <a href="categoria.html?cat=intercooler">Intercooler</a>
                                    <ul class="submenu-2">
                                        <!-- Itens ser√£o preenchidos dinamicamente -->
                                    </ul>
                                </li>
                                <li class="has-submenu">
                                    <a href="categoria.html?cat=gmv">GMV</a>
                                    <ul class="submenu-2">
                                        <!-- Itens ser√£o preenchidos dinamicamente -->
                                    </ul>
                                </li>
                                <li class="has-submenu">
                                    <a href="categoria.html?cat=eletroventilador">Eletroventilador</a>
                                    <ul class="submenu-2">
                                        <!-- Itens ser√£o preenchidos dinamicamente -->
                                    </ul>
                                </li>
                                <li class="has-submenu">
                                    <a href="categoria.html?cat=condensador">Condensador</a>
                                    <ul class="submenu-2">
                                        <!-- Itens ser√£o preenchidos dinamicamente -->
                                    </ul>
                                </li>
                                <li class="has-submenu">
                                    <a href="categoria.html?cat=evaporadora">Evaporadora</a>
                                    <ul class="submenu-2">
                                        <!-- Itens ser√£o preenchidos dinamicamente -->
                                    </ul>
                                </li>
                                <li class="has-submenu">
                                    <a href="categoria.html?cat=radiador de √≥leo motor">Radiador de √≥leo motor</a>
                                    <ul class="submenu-2">
                                        <!-- Itens ser√£o preenchidos dinamicamente -->
                                    </ul>
                                </li>
                                <li class="has-submenu">
                                    <a href="categoria.html?cat=radiador de √≥leo transmiss√£o">Radiador de √≥leo transmiss√£o</a>
                                    <ul class="submenu-2">
                                        <!-- Itens ser√£o preenchidos dinamicamente -->
                                    </ul>
                                </li>
                                <li class="has-submenu">
                                    <a href="categoria.html?cat=radiador de aquecimento">Radiador de aquecimento </a>
                                    <ul class="submenu-2">
                                        <!-- Itens ser√£o preenchidos dinamicamente -->
                                    </ul>
                                </li>
                            </ul>
                    </div>
                    <a id="userLink" href="login.html" style="font-size:30px; cursor:pointer; position:relative;">
                    <i id="userIcon" class="fa-solid fa-user" style="color: #134596;"></i>
                    </a>
                    <span style="font-size:30px;cursor:pointer" onclick="toggleMenuCarrinho()">
                        <i style="font-size:30px;cursor:pointer" class="fa-solid fa-cart-shopping"></i>
                    </span>
                    <span style="font-size:30px;cursor:pointer" onclick="toggleMenu()">
                        <i class="fa-regular fa-heart"></i>
                    </span>
            </div>

            <div id="menuoculto2" class="menuoculto2">
  <div class="escolha_catalogo">
    <div class="header-categoria">
      <h3 class="colorCategoria">Montadoras</h3>
      <div class="header-filtros">
        <button class="select-all-btn" onclick="toggleAllCheckboxes('montadoras')">
          <i class="fa-solid fa-check-double"></i>
          Selecionar Todos
        </button>
        <input
          type="text"
          id="searchMontadoras"
          placeholder="Buscar montadoras..."
          onInput="filterCheckboxesMontadoras()"
          style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;"
        />
      </div>
    </div>
    <div id="checkboxContainer" class="checkbox-container"></div>
  </div>

  <div class="escolha_catalogo">
    <div class="header-categoria">
      <h3 class="colorCategoria">Categorias</h3>
      <div class="header-filtros">
        <button class="select-all-btn" onclick="toggleAllCheckboxes('categorias')">
          <i class="fa-solid fa-check-double"></i>
          Selecionar Todos
        </button>
        <input
          type="text"
          id="searchCategorias"
          placeholder="Buscar categorias..."
          onInput="filterCheckboxesCategorias()"
          style=" padding: 5px; border-radius: 4px; border: 1px solid #ccc;"
        />
      </div>
    </div>
    <div id="checkboxContainer2" class="checkbox-container"></div>
  </div>

  <!-- bot√µes de a√ß√£o -->
  <div class="menuoculto2-actions">
    <button
      type="button"
      class="buscar-btn"
      onclick="fecharNav2()"
    >
      üîé
    </button>
    <button
      type="button"
      class="fechar-btn"
      onclick="apenasFecharNav2()"
    >
      √ó
    </button>
  </div>
</div>
        </nav>
    </header>

    <div id="filtroAvancado" class="filtro-avancado" style="display: none;">
        <div class="filtro-avancado-header">
            <span>FILTRO AVAN√áADO</span>
        </div>
        <div class="filtro-avancado-content">
            <div class="filtro-row">
                <!-- Accordion para Tipo de Produto (Categoria) -->
                <div class="filtro-accordion">
                    <div class="filtro-accordion-header" onclick="toggleAccordion('categoria')">
                        <span>TIPO DE PRODUTO</span>
                        <i class="fa-solid fa-chevron-down filtro-accordion-icon"></i>
                    </div>
                    <div class="filtro-accordion-content" id="accordion-categoria">
                        <div class="filtro-accordion-body">
                            <input type="text" class="filtro-search" placeholder="Buscar tipo de produto..." id="search-categoria" oninput="filtrarOpcoes('categoria', this.value)">
                            <div class="filtro-checkbox-list" id="lista-categoria">
                                <!-- Checkboxes ser√£o inseridos aqui dinamicamente -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Accordion para Montadora -->
                <div class="filtro-accordion">
                    <div class="filtro-accordion-header" onclick="toggleAccordion('montadora')">
                        <span>MONTADORA</span>
                        <i class="fa-solid fa-chevron-down filtro-accordion-icon"></i>
                    </div>
                    <div class="filtro-accordion-content" id="accordion-montadora">
                        <div class="filtro-accordion-body">
                            <input type="text" class="filtro-search" placeholder="Buscar montadora..." id="search-montadora" oninput="filtrarOpcoes('montadora', this.value)">
                            <div class="filtro-checkbox-list" id="lista-montadora">
                                <!-- Checkboxes ser√£o inseridos aqui dinamicamente -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campos de Ano e Busca Geral -->
                <input type="number" id="filtroAnoInicio" placeholder="ANO IN√çC" class="filtro-input-ano" min="1900" max="2030">
                <input type="number" id="filtroAnoFim" placeholder="ANO FIM" class="filtro-input-ano" min="1900" max="2030">
                
                <!-- Dropdown para sele√ß√£o de campo de busca -->
                <div class="filtro-busca-container">
                    <div class="filtro-campo-accordion">
                        <div class="filtro-campo-header" onclick="toggleCampoAccordion()">
                            <span id="campo-selecionado">BUSCAR EM</span>
                            <i class="fa-solid fa-chevron-down filtro-campo-icon"></i>
                        </div>
                        <div class="filtro-campo-content" id="filtro-campo-dropdown">
                            <div class="filtro-campo-list">
                                <div class="filtro-campo-item" onclick="selecionarCampo('todos', 'BUSCAR EM')">TODOS</div>
                                <div class="filtro-campo-item" onclick="selecionarCampo('categoria', 'CATEGORIA')">CATEGORIA</div>
                                <div class="filtro-campo-item" onclick="selecionarCampo('montadora', 'MONTADORA')">MONTADORA</div>
                                <div class="filtro-campo-item" onclick="selecionarCampo('modelo', 'MODELO')">MODELO</div>
                                <div class="filtro-campo-item" onclick="selecionarCampo('codigo', 'C√ìDIGO')">C√ìDIGO</div>
                                <div class="filtro-campo-item" onclick="selecionarCampo('referencia', 'REFER√äNCIA')">REFER√äNCIA</div>
                                <div class="filtro-campo-item" onclick="selecionarCampo('descricao', 'DESCRI√á√ÉO')">DESCRI√á√ÉO</div>
                                <div class="filtro-campo-item" onclick="selecionarCampo('ano', 'ANO')">ANO</div>
                                <div class="filtro-campo-item" onclick="selecionarCampo('placa', 'PLACA')">PLACA</div>
                            </div>
                        </div>
                    </div>
                    <input type="text" id="filtroBuscaGeral" placeholder="C√≥digo, descri√ß√£o, modelo do ve√≠culo" class="filtro-input-wide">
                </div>
                
                <!-- Bot√µes -->
                <button type="button" id="btnLimparFiltros" class="filtro-btn-limpar">LIMPAR</button>
                <button type="button" id="btnBuscarAvancado" class="filtro-btn-buscar">BUSCAR</button>
            </div>
        </div>
    </div>

    <aside id="menuoculto" class="menuoculto">
        <button class="btnFechar" onclick="fecharNav()" aria-label="Fechar menu">&times;</button>
        
        <div class="menu-content">
            <div id="cart-total" class="counter-list-favorites">
                <i class="fa-solid fa-heart" style="font-size: 20px; color: #fff;"></i>
                Meus Favoritos
            </div>

            <div id="cart-items" class="cart-items-container">
                <!-- Itens do carrinho ser√£o adicionados aqui -->
            </div>

            <div class="menu-actions">
                <button id="toggleAllButton" onclick="toggleAllFavorites()" class="action-button">
                    <i class="fa-solid fa-check-double"></i>
                    Marcar Todos
                </button>
                <button id="send-to-cart" onclick="sendFavoritesToCart()" class="action-button">
                    <i class="fa-solid fa-arrow-right"></i>
                    Enviar ao carrinho
                </button>
            </div>
        </div>
    </aside>

    <!-- Menu oculto para o carrinho -->
    <aside id="menuoculto-carrinho" class="menuoculto">      
        <button class="btnFechar" onclick="fecharNavCarrinho()" aria-label="Fechar menu">&times;</button>
        <div class="menu-content">
            <div id="cart-total" class="counter-list-favorites">
                <i class="fa-solid fa-cart-shopping" style="color: #fff; font-size: 20px;"></i>
                Meu Carrinho
            </div>
            
            <div id="cart-items-carrinho" class="cart-items-container">
                <!-- Itens do carrinho ser√£o adicionados aqui -->
            </div>

            <div class="menu-actions">
                <button id="checkoutButtonCarrinho" onclick="window.location.href =
                    `carrinho.html`;" class="action-button">
                    <i class="fa-solid fa-shopping-cart"></i>
                    Ir para o Carrinho
                </button>
                <button id="limpar-carrinho" onclick="limparCarrinho()" class="action-button">
                    <i class="fa-solid fa-trash"></i>
                    Limpar Carrinho
                </button>
            </div>
        </div>
    </aside>

  <!-- CONTE√öDO PRINCIPAL DE CONFIGURA√á√ïES -->
  <div class="settings-wrapper">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <!-- Avatar do usu√°rio -->
      <div
        id="userAvatar"
        class="avatar-placeholder"
      >
        <span id="avatarInitial"></span>
      </div>

      <!-- Menu de op√ß√µes do avatar (inicialmente oculto) -->
      <div
        id="avatarOptions"
        style="
          display: none;
          position: absolute;
          top: calc(100% + 5px);
          left: 50%;
          transform: translateX(-50%);
          background: #fff;
          border: 1px solid #ccc;
          border-radius: 4px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
          width: 160px;
          z-index: 1000;
        "
      >
        <button
          type="button"
          id="selectAvatarButton"
          style="width: 100%; padding: 8px 0; border: none; background: none; cursor: pointer;"
        >
          <i class="fa-solid fa-camera"></i> Carregar Foto
        </button>
        <hr style="margin: 0;" />
        <button
          type="button"
          id="removePhotoButton"
          style="width: 100%; padding: 8px 0; border: none; background: none; cursor: pointer;"
        >
          <i class="fa-solid fa-trash"></i> Remover Foto
        </button>
      </div>

      <!-- Input file escondido para selecionar imagem -->
      <input type="file" id="avatarFileInput" accept="image/*" style="display: none;" />

      <!-- Texto de boas-vindas -->
      <div class="welcome-text" id="sidebarWelcome">Ol√°, Usu√°rio</div>

      <!-- Links do Sidebar -->
      <nav>
        <a href="#" id="navConfiguracoes" class="active">
          <i class="fa-solid fa-gear"></i><span>Configura√ß√µes</span>
        </a>
        <a href="#" id="navFiliais">
          <i class="fa-solid fa-user-group"></i><span>Filiais</span>
        </a>
      </nav>

      <!-- Link de logout -->
      <div class="logout-link" id="sidebarLogout">
        <a style="cursor: pointer;">
          <i class="fa-solid fa-right-from-bracket"></i><span>Sair</span>
        </a>
      </div>
    </aside>

    <!-- √ÅREA PRINCIPAL DE CONFIGURA√á√ïES -->
    <main class="settings-content">
      <div class="settings-card">
        <div class="settings-header">
          <h2>Informa√ß√µes Pessoais</h2>
        </div>

        <div class="settings-sections">
          <!-- Coluna PERFIL -->
          <div class="profile-section">
            <div class="section-title">1. CONTA</div>

            <form id="formProfile">
              <label for="inputNome">Nome</label>
              <input
                id="inputNome"
                type="text"
                placeholder="Nome completo"
                disabled
              />

              <label for="inputEmail">Seu Email</label>
              <input id="inputEmail" type="email" readonly />

              <label for="inputCnpj">CNPJ</label>
              <input id="inputCnpj" type="text" readonly />

              <label for="inputNumero">N√∫mero</label>
              <input
                id="inputNumero"
                type="text"
                placeholder="N√∫mero"
                disabled
              />
            </form>
          </div>

          <!-- Coluna SENHA -->
          <div class="password-section">
            <div class="section-title">2. SENHA</div>

            <form id="formPassword">
              <label for="inputOldPassword">Senha Atual</label>
              <input
                id="inputOldPassword"
                type="password"
                placeholder="Senha atual"
                disabled
              />

              <label for="inputNewPassword">Nova Senha</label>
              <input
                id="inputNewPassword"
                type="password"
                placeholder="Nova senha"
                disabled
              />

              <label for="inputConfirmNewPassword">Confirmar nova senha *</label>
              <input
                id="inputConfirmNewPassword"
                type="password"
                placeholder="Confirme a nova senha"
                disabled
              />
            </form>
          </div>
        </div>

        <!-- Bot√µes Editar / Salvar -->
        <div
          class="settings-buttons"
          style="margin-top: 1rem; display: flex; gap: 0.5rem;"
        >
          <button
            type="button"
            id="btnEditProfile"
            class="btn btn-outline-primary"
          >
            <i class="fa-solid fa-pen-to-square"></i> Editar
          </button>

          <button
            type="button"
            id="btnSaveAll"
            class="btn btn-outline-primary"
            disabled
          >
            <i class="fa-solid fa-floppy-disk"></i> Salvar Informa√ß√µes
          </button>
        </div>

        <!-- Mensagem de feedback -->
        <div id="msgFeedback" style="margin-top: 1rem; color: #d9534f;"></div>
      </div>

      <!-- Aba de Filiais (inicialmente oculta) -->
      <div id="filiaisSection" class="settings-card" style="display: none;">
        <div class="settings-header">
          <h2>Filiais</h2>
        </div>
        <div class="settings-sections">
          <!-- Tabela de CNPJs com novas colunas -->
          <div id="filialMsgFeedback" style="color: #d9534f; margin-bottom: .5rem;"></div>
          <div id="filialMsgFeedback" style="color: #d9534f; margin-bottom: .5rem;"></div>
          <div class="table-responsive-wrapper">
            <table id="filiaisTable" class="table">
              <thead>
                <tr>
                  <th>CNPJ</th>
                  <th>Nome</th>
                  <th>Fantasia</th>
                  <th>Endere√ßo</th>
                  <th>Telefone</th>
                  <th>Email</th>
                  <th>A√ß√µes</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <!-- Formul√°rio para nova filial -->
          <div class="add-filial" style="margin-top: 1rem;">
            <input
              type="text"
              id="inputNovoCnpj"
              placeholder="Digite o novo CNPJ"
              class="form-control"
            />
            <input
              type="text"
              id="inputFilialPhone"
              placeholder="Telefone"
              class="form-control"
            />
            <input
              type="email"
              id="inputFilialEmail"
              placeholder="Email"
              class="form-control"
            />
            <button type="button" id="btnAddCnpj" class="btn btn-primary">
              Adicionar
            </button>
          </div>

        </div>
      </div>


    </main>
  </div>

  <script type="module" src="./firebase-config.js"></script>
  <!-- Script de configura√ß√µes (l√≥gica JS) -->
  <script type="module" src="./javascript/configuracoes.js"></script>
  <!-- Outros scripts (Bootstrap, Swiper, etc.) -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
  <script src="./javascript/script.js"></script>
  <script src="./javascript/index.js"></script>
  <script src="./javascript/newsletter.js"></script>
  <script
    src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"
  ></script>
  <script>
    // Fun√ß√µes do accordion e filtro avan√ßado completo
    function carregarOpcoesDropdown() {
        fetch('./conversor/produtos.json')
            .then(r => r.json())
            .then(produtos => {
                // Armazenar produtos globalmente para uso na filtragem
                window.produtosData = produtos;

                // Carregar categorias
                const categorias = [...new Set(produtos.map(p => p.categoria).filter(Boolean))].sort();
                carregarCheckboxes('categoria', categorias);

                // Carregar todas as montadoras inicialmente
                const montadoras = [...new Set(produtos.map(p => p.montadora).filter(Boolean))].sort();
                carregarCheckboxes('montadora', montadoras);
            })
            .catch(console.error);
    }

        function carregarCheckboxes(tipo, opcoes) {
            const container = document.getElementById(`lista-${tipo}`);
            if (!container) return;

            container.innerHTML = '';
            
            opcoes.forEach(opcao => {
                const item = document.createElement('div');
                item.className = 'filtro-checkbox-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `${tipo}-${opcao.replace(/\s+/g, '-').replace(/[^\w-]/g, '')}`;
                checkbox.value = opcao;
                checkbox.addEventListener('change', () => {
                    atualizarContadores();
                    // Se for categoria, atualizar montadoras quando mudar sele√ß√£o
                    if (tipo === 'categoria') {
                        atualizarMontadorasPorCategoria();
                    }
                });
                
                const label = document.createElement('label');
                label.setAttribute('for', checkbox.id);
                label.textContent = opcao.toUpperCase();
                
                item.appendChild(checkbox);
                item.appendChild(label);
                container.appendChild(item);
            });
            
            // Atualizar contadores inicialmente
            atualizarContadores();
        }

        function atualizarMontadorasPorCategoria() {
            if (!window.produtosData) return;

            // Obter categorias selecionadas
            const categoriasSelecionadas = Array.from(document.querySelectorAll('#lista-categoria input[type="checkbox"]:checked')).map(cb => cb.value);
            
            let montadorasDisponiveis = [];
            
            if (categoriasSelecionadas.length === 0) {
                // Se nenhuma categoria selecionada, mostrar todas as montadoras
                montadorasDisponiveis = [...new Set(window.produtosData.map(p => p.montadora).filter(Boolean))].sort();
            } else {
                // Filtrar produtos pelas categorias selecionadas
                const produtosFiltrados = window.produtosData.filter(produto => 
                    categoriasSelecionadas.some(cat => 
                        produto.categoria && produto.categoria.toLowerCase() === cat.toLowerCase()
                    )
                );
                
                // Obter montadoras √∫nicas dos produtos filtrados
                montadorasDisponiveis = [...new Set(produtosFiltrados.map(p => p.montadora).filter(Boolean))].sort();
            }

            // Salvar sele√ß√µes atuais de montadora
            const montadorasSelecionadas = Array.from(document.querySelectorAll('#lista-montadora input[type="checkbox"]:checked')).map(cb => cb.value);
            
            // Recarregar checkboxes de montadora
            const containerMontadora = document.getElementById('lista-montadora');
            if (!containerMontadora) return;

            containerMontadora.innerHTML = '';
            
            montadorasDisponiveis.forEach(montadora => {
                const item = document.createElement('div');
                item.className = 'filtro-checkbox-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `montadora-${montadora.replace(/\s+/g, '-').replace(/[^\w-]/g, '')}`;
                checkbox.value = montadora;
                
                // Manter sele√ß√£o anterior se a montadora ainda estiver dispon√≠vel
                if (montadorasSelecionadas.includes(montadora)) {
                    checkbox.checked = true;
                }
                
                checkbox.addEventListener('change', atualizarContadores);
                
                const label = document.createElement('label');
                label.setAttribute('for', checkbox.id);
                label.textContent = montadora.toUpperCase();
                
                item.appendChild(checkbox);
                item.appendChild(label);
                containerMontadora.appendChild(item);
            });
            
            // Atualizar contadores
            atualizarContadores();
        }    function toggleAccordion(tipo) {
        const header = document.querySelector(`[onclick="toggleAccordion('${tipo}')"]`);
        const content = document.getElementById(`accordion-${tipo}`);
        
        // Fechar dropdown de campo se estiver aberto
        const campoHeader = document.querySelector('.filtro-campo-header');
        const campoContent = document.querySelector('.filtro-campo-content');
        if (campoHeader && campoContent) {
            campoHeader.classList.remove('active');
            campoContent.classList.remove('active');
        }
        
        // Fechar outros accordions
        document.querySelectorAll('.filtro-accordion-header').forEach(h => {
            if (h !== header) {
                h.classList.remove('active');
            }
        });
        document.querySelectorAll('.filtro-accordion-content').forEach(c => {
            if (c !== content) {
                c.classList.remove('active');
            }
        });
        
        // Toggle do accordion atual
        header.classList.toggle('active');
        content.classList.toggle('active');
    }

    function toggleCampoAccordion() {
        const accordion = document.querySelector('.filtro-campo-accordion');
        const header = document.querySelector('.filtro-campo-header');
        const content = document.querySelector('.filtro-campo-content');
        
        // Fechar outros accordions se estiverem abertos
        document.querySelectorAll('.filtro-accordion-header').forEach(h => {
            h.classList.remove('active');
        });
        document.querySelectorAll('.filtro-accordion-content').forEach(c => {
            c.classList.remove('active');
        });
        
        // Toggle do dropdown de campo
        header.classList.toggle('active');
        content.classList.toggle('active');
    }

    let campoSelecionado = 'todos';

    function selecionarCampo(campo, texto) {
        campoSelecionado = campo;
        document.getElementById('campo-selecionado').textContent = texto;
        
        // Fechar o dropdown
        document.querySelector('.filtro-campo-header').classList.remove('active');
        document.querySelector('.filtro-campo-content').classList.remove('active');
        
        // Atualizar placeholder da busca
        const input = document.getElementById('filtroBuscaGeral');
        if (input) {
            switch(campo) {
                case 'todos':
                    input.placeholder = 'C√≥digo, descri√ß√£o, modelo do ve√≠culo';
                    break;
                case 'categoria':
                    input.placeholder = 'Buscar por categoria...';
                    break;
                case 'montadora':
                    input.placeholder = 'Buscar por montadora...';
                    break;
                case 'modelo':
                    input.placeholder = 'Buscar por modelo...';
                    break;
                case 'codigo':
                    input.placeholder = 'Buscar por c√≥digo...';
                    break;
                case 'referencia':
                    input.placeholder = 'Buscar por c√≥digo de refer√™ncia...';
                    break;
                case 'descricao':
                    input.placeholder = 'Buscar por descri√ß√£o...';
                    break;
                case 'ano':
                    input.placeholder = 'Buscar por ano...';
                    break;
            }
        }
    }

    function searchInSpecificField(produto, termo, campo) {
        const termosNormalizados = termo.toLowerCase().split(/\s+/).filter(t => t.length > 0);
        
        if (campo === 'todos') {
            // Busca em todos os campos
            const campos = [
                produto.codigo,
                produto.descricao,
                produto.categoria,
                produto.montadora,
                produto.modelo,
                produto.ano,
                produto.referencia,
                produto.codigo_referencia,
                produto.codigoReferencia,
                produto.referenciaoriginal,
                produto.crossreference,
                produto.oem,
                produto.denso,
                produto.mahle,
                produto.marelli,
                produto.valeo,
                produto.visconde
            ];
            
            return termosNormalizados.every(termo =>
                campos.some(campo => 
                    campo && campo.toString().toLowerCase().includes(termo)
                )
            );
        } else {
            // Busca no campo espec√≠fico
            let valorCampo = '';
            switch(campo) {
                case 'categoria':
                    valorCampo = produto.categoria;
                    break;
                case 'montadora':
                    valorCampo = produto.montadora;
                    break;
                case 'modelo':
                    valorCampo = produto.modelo;
                    break;
                case 'codigo':
                    valorCampo = produto.codigo;
                    break;
                case 'referencia':
                    // Busca em todos os campos de refer√™ncia das diferentes marcas
                    const camposReferencia = [
                        produto.referencia,
                        produto.codigo_referencia,
                        produto.codigoReferencia,
                        produto.referenciaoriginal,
                        produto.crossreference,
                        produto.oem,
                        produto.denso,
                        produto.mahle,
                        produto.marelli,
                        produto.valeo,
                        produto.visconde
                    ];
                    
                    // Concatena todos os valores de refer√™ncia que existem
                    valorCampo = camposReferencia
                        .filter(campo => campo && campo !== null && campo !== '')
                        .join(' ');
                    break;
                case 'descricao':
                    valorCampo = produto.descricao;
                    break;
                case 'ano':
                    valorCampo = produto.ano;
                    break;
            }
            
            if (!valorCampo) return false;
            
            const valorNormalizado = valorCampo.toString().toLowerCase();
            return termosNormalizados.every(termo => valorNormalizado.includes(termo));
        }
    }

    function filtrarOpcoes(tipo, termo) {
        const lista = document.getElementById(`lista-${tipo}`);
        const items = lista.querySelectorAll('.filtro-checkbox-item');
        const termoBusca = termo.toLowerCase().trim();
        
        items.forEach(item => {
            const label = item.querySelector('label');
            const texto = label.textContent.toLowerCase();
            
            if (termoBusca === '' || texto.includes(termoBusca)) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    }

    function atualizarContadores() {
        const tipos = ['categoria', 'montadora'];
        
        tipos.forEach(tipo => {
            const checkboxes = document.querySelectorAll(`#lista-${tipo} input[type="checkbox"]:checked`);
            const header = document.querySelector(`[onclick="toggleAccordion('${tipo}')"] span`);
            const count = checkboxes.length;
            
            if (count > 0) {
                const textoOriginal = tipo === 'categoria' ? 'TIPO DE PRODUTO' : 'MONTADORA';
                header.textContent = `${textoOriginal} (${count})`;
                header.parentElement.style.backgroundColor = '#134596';
                header.parentElement.style.color = 'white';
            } else {
                const textoOriginal = tipo === 'categoria' ? 'TIPO DE PRODUTO' : 'MONTADORA';
                header.textContent = textoOriginal;
                header.parentElement.style.backgroundColor = '#f8f9fa';
                header.parentElement.style.color = '#134596';
            }
        });
    }

    function aplicarFiltroAvancado() {
        // Obter sele√ß√µes m√∫ltiplas dos checkboxes
        const categoriasSelecionadas = Array.from(document.querySelectorAll('#lista-categoria input[type="checkbox"]:checked')).map(cb => cb.value);
        const montadorasSelecionadas = Array.from(document.querySelectorAll('#lista-montadora input[type="checkbox"]:checked')).map(cb => cb.value);
        
        const anoInicio = document.getElementById('filtroAnoInicio').value;
        const anoFim = document.getElementById('filtroAnoFim').value;
        const buscaGeral = document.getElementById('filtroBuscaGeral').value.trim();

        // Construir URL para todosprodutos.html com par√¢metros
        let url = 'todosprodutos.html?';
        const params = [];
        
        // Adicionar categorias
        if (categoriasSelecionadas.length > 0) {
            categoriasSelecionadas.forEach(cat => {
                params.push(`categoria=${encodeURIComponent(cat)}`);
            });
        }
        
        // Adicionar montadoras
        if (montadorasSelecionadas.length > 0) {
            montadorasSelecionadas.forEach(mont => {
                params.push(`montadora=${encodeURIComponent(mont)}`);
            });
        }
        
        if (anoInicio) params.push(`anoInicio=${anoInicio}`);
        if (anoFim) params.push(`anoFim=${anoFim}`);
        if (buscaGeral) {
            params.push(`search=${encodeURIComponent(buscaGeral)}`);
            params.push(`campo=${encodeURIComponent(campoSelecionado)}`);
        }
        
        url += params.join('&');
        
        // Redirecionar para a p√°gina de produtos com os filtros aplicados
        window.location.href = url;
    }

    function limparFiltros() {
        // Limpa todos os checkboxes
        document.querySelectorAll('#lista-categoria input[type="checkbox"]:checked').forEach(cb => cb.checked = false);
        document.querySelectorAll('#lista-montadora input[type="checkbox"]:checked').forEach(cb => cb.checked = false);
        
        // Limpa campos de ano e busca
        document.getElementById('filtroAnoInicio').value = '';
        document.getElementById('filtroAnoFim').value = '';
        document.getElementById('filtroBuscaGeral').value = '';

            // Reset do campo selecionado
            campoSelecionado = 'todos';
            document.getElementById('campo-selecionado').textContent = 'BUSCAR EM';
            document.getElementById('filtroBuscaGeral').placeholder = 'C√≥digo, descri√ß√£o, modelo do ve√≠culo';

            // Recarregar todas as montadoras (sem filtro de categoria)
            atualizarMontadorasPorCategoria();

            // Atualizar contadores
            atualizarContadores();
        }    // Fun√ß√£o para abrir filtro avan√ßado
    function toggleFiltroAvancado() {
        const filtro = document.getElementById('filtroAvancado');
        
        if (filtro.classList.contains('show')) {
            // Esconder com anima√ß√£o
            filtro.classList.remove('show');
            setTimeout(() => {
                filtro.style.display = 'none';
            }, 400); // Tempo da transi√ß√£o CSS
        } else {
            // Mostrar com anima√ß√£o
            filtro.style.display = 'block';
            // For√ßa o reflow para que a transi√ß√£o funcione
            filtro.offsetHeight;
            filtro.classList.add('show');
            carregarOpcoesDropdown();
        }
    }

    // Event listeners para o filtro avan√ßado
    document.addEventListener('DOMContentLoaded', () => {
        const btnBuscar = document.getElementById('btnBuscarAvancado');
        if (btnBuscar) {
            btnBuscar.addEventListener('click', aplicarFiltroAvancado);
        }

        const btnLimpar = document.getElementById('btnLimparFiltros');
        if (btnLimpar) {
            btnLimpar.addEventListener('click', limparFiltros);
        }

        // Enter nos campos de input (apenas anos e busca geral)
        ['filtroAnoInicio', 'filtroAnoFim', 'filtroBuscaGeral'].forEach(id => {
            const input = document.getElementById(id);
            if (input) {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        aplicarFiltroAvancado();
                    }
                });
            }
        });

        // Event listener para fechar dropdown quando clicar fora
        document.addEventListener('click', (e) => {
            const campoAccordion = document.querySelector('.filtro-campo-accordion');
            if (campoAccordion && !campoAccordion.contains(e.target)) {
                const header = document.querySelector('.filtro-campo-header');
                const content = document.querySelector('.filtro-campo-content');
                if (header && content) {
                    header.classList.remove('active');
                    content.classList.remove('active');
                }
            }
        });
    });
  </script>
</body>
</html>
